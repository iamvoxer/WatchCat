<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WatchCat - Dashboard</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="server/server.css" />
    <link rel="stylesheet" href="watch/watch.css" />
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="logo.png" alt="WatchCat Logo" class="sidebar-logo" />
        <h1>WatchCat</h1>
      </div>

      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="#" class="nav-link active" data-section="dashboard">
              üìä Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="servers"> üñ•Ô∏è Server </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="applications">
              ‚öôÔ∏è Application
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="watch-templates">
              üìã Watch
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="alerts"> üö® Alert </a>
          </li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <h2 id="pageTitle">Dashboard</h2>
        <div class="header-actions">
          <span class="user-name" id="headerUserName">Loading...</span>
          <button class="btn btn-primary" id="changePasswordBtn">
            üîí Change Password
          </button>
          <button class="btn btn-danger" id="headerLogoutBtn">üö™ Logout</button>
        </div>
      </header>

      <!-- Dashboard Section -->
      <section class="content-section active" id="dashboard">
        <div class="dashboard-cards">
          <div class="card">
            <h3>Total Servers</h3>
            <div class="value" id="totalServers">0</div>
            <div class="label">Monitored Servers</div>
          </div>
          <div class="card">
            <h3>Online Servers</h3>
            <div class="value" id="onlineServers">0</div>
            <div class="label">Currently Active</div>
          </div>
          <div class="card">
            <h3>Total Applications</h3>
            <div class="value" id="totalApplications">0</div>
            <div class="label">Monitored Applications</div>
          </div>
          <div class="card">
            <h3>Active Alerts</h3>
            <div class="value" id="activeAlerts">0</div>
            <div class="label">Requires Attention</div>
          </div>
        </div>

        <h3>Recent Activity</h3>
        <table class="table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Server</th>
              <th>Event</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="recentActivity">
            <tr>
              <td colspan="4" style="text-align: center; color: #666">
                No recent activity
              </td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Server Management Section -->
      <section class="content-section" id="servers">
        <div class="server-header">
          <h3>Server Management</h3>
          <button class="btn btn-primary" id="addServerBtn">
            + Add Server
          </button>
        </div>

        <div class="server-list" id="serverContainer">
          <div class="loading-message">Loading servers...</div>
        </div>

        <!-- Server Form Sidebar -->
        <div class="server-sidebar-overlay" id="serverSidebarOverlay"></div>
        <div class="server-sidebar" id="serverSidebar">
          <div class="server-sidebar-header">
            <h3 id="serverSidebarTitle">Add Server</h3>
            <button class="server-sidebar-close" id="serverSidebarClose">
              &times;
            </button>
          </div>
          <div class="server-sidebar-content">
            <form id="serverForm">
              <div class="form-group">
                <label for="serverName">Server Name *</label>
                <input
                  type="text"
                  id="serverName"
                  name="name"
                  required
                  placeholder="Enter server name"
                />
              </div>

              <div class="form-group">
                <label for="serverIP">IP Address *</label>
                <input
                  type="text"
                  id="serverIP"
                  name="ip"
                  required
                  placeholder="192.168.1.100"
                />
              </div>

              <div class="form-group">
                <label for="serverDesc">Description</label>
                <textarea
                  id="serverDesc"
                  name="desc"
                  rows="3"
                  placeholder="Optional description"
                ></textarea>
              </div>

              <div class="form-group">
                <label for="serverUsername">Username</label>
                <input
                  type="text"
                  id="serverUsername"
                  name="username"
                  placeholder="root"
                  value="root"
                />
              </div>

              <div class="form-group">
                <label for="serverPassword">Password</label>
                <input
                  type="password"
                  id="serverPassword"
                  name="password"
                  placeholder="Enter password"
                />
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn-secondary"
                  id="serverFormCancel"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn btn-primary"
                  id="serverFormSubmit"
                >
                  <span id="serverFormSubmitText">Add Server</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Application Management Section -->
      <section class="content-section" id="applications">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
          "
        >
          <h3>Application List</h3>
          <button class="btn btn-primary" id="addApplicationBtn">
            + Add Application
          </button>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>Application Name</th>
              <th>Server</th>
              <th>Type</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="applicationList">
            <tr>
              <td colspan="5" style="text-align: center; color: #666">
                No applications configured
              </td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Watch Templates Section -->
      <section class="content-section" id="watch-templates">
        <!-- Template List -->
        <div class="templates-container" id="templatesContainer">
          <div class="loading-message">
            <div class="loading-spinner"></div>
            <p>Loading watch templates...</p>
          </div>
        </div>
      </section>

      <!-- Alert Management Section -->
      <section class="content-section" id="alerts">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
          "
        >
          <h3>Alert Rules</h3>
          <button class="btn btn-primary" id="addAlertBtn">
            + Add Alert Rule
          </button>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>Rule Name</th>
              <th>Condition</th>
              <th>Threshold</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="alertList">
            <tr>
              <td colspan="5" style="text-align: center; color: #666">
                No alert rules configured
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </main>

    <div class="connection-status disconnected" id="connectionStatus">
      Disconnected
    </div>

    <!-- Confirmation Modal -->
    <div class="confirm-overlay" id="confirmOverlay">
      <div class="confirm-modal">
        <div class="confirm-header">
          <h3 id="confirmTitle">Confirm Action</h3>
        </div>
        <div class="confirm-content">
          <p id="confirmMessage">
            Are you sure you want to perform this action?
          </p>
        </div>
        <div class="confirm-actions">
          <button class="btn btn-secondary" id="confirmCancel">Cancel</button>
          <button class="btn btn-danger" id="confirmOk">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
      // Global confirmation dialog
      let confirmResolve = null;

      window.showConfirm = function (message, title = "Confirm Action") {
        return new Promise((resolve) => {
          confirmResolve = resolve;

          document.getElementById("confirmTitle").textContent = title;
          document.getElementById("confirmMessage").textContent = message;
          document.getElementById("confirmOverlay").classList.add("show");
        });
      };

      // Global toast notification system
      let toastCounter = 0;

      window.showToast = function (
        message,
        type = "info",
        title = null,
        duration = 5000
      ) {
        const toastContainer = document.getElementById("toastContainer");
        const toastId = "toast-" + ++toastCounter;

        // Default titles and icons for different types
        const typeConfig = {
          success: { title: title || "Success", icon: "‚úì" },
          error: { title: title || "Error", icon: "‚úï" },
          warning: { title: title || "Warning", icon: "‚ö†" },
          info: { title: title || "Info", icon: "i" },
        };

        const config = typeConfig[type] || typeConfig.info;

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.id = toastId;
        toast.innerHTML = `
          <div class="toast-header">
            <div class="toast-icon">${config.icon}</div>
            <h4 class="toast-title">${config.title}</h4>
            <button class="toast-close" onclick="hideToast('${toastId}')">&times;</button>
          </div>
          <div class="toast-body">${message}</div>
          ${duration > 0 ? '<div class="toast-progress"></div>' : ""}
        `;

        toastContainer.appendChild(toast);

        // Trigger animation
        setTimeout(() => {
          toast.classList.add("show");
        }, 10);

        // Auto dismiss
        if (duration > 0) {
          setTimeout(() => {
            hideToast(toastId);
          }, duration);
        }

        return toastId;
      };

      window.hideToast = function (toastId) {
        const toast = document.getElementById(toastId);
        if (toast) {
          toast.classList.add("removing");
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }
      };

      // Convenience methods
      window.showSuccess = function (message, title, duration) {
        return showToast(message, "success", title, duration);
      };

      window.showError = function (message, title, duration) {
        return showToast(message, "error", title, duration);
      };

      window.showWarning = function (message, title, duration) {
        return showToast(message, "warning", title, duration);
      };

      window.showInfo = function (message, title, duration) {
        return showToast(message, "info", title, duration);
      };

      function hideConfirm() {
        document.getElementById("confirmOverlay").classList.remove("show");
      }

      // Event listeners for confirmation dialog
      document.addEventListener("DOMContentLoaded", function () {
        const confirmOverlay = document.getElementById("confirmOverlay");
        const confirmCancel = document.getElementById("confirmCancel");
        const confirmOk = document.getElementById("confirmOk");

        // Cancel button
        confirmCancel.addEventListener("click", function () {
          hideConfirm();
          if (confirmResolve) {
            confirmResolve(false);
            confirmResolve = null;
          }
        });

        // Confirm button
        confirmOk.addEventListener("click", function () {
          hideConfirm();
          if (confirmResolve) {
            confirmResolve(true);
            confirmResolve = null;
          }
        });

        // Click outside to cancel
        confirmOverlay.addEventListener("click", function (e) {
          if (e.target === confirmOverlay) {
            hideConfirm();
            if (confirmResolve) {
              confirmResolve(false);
              confirmResolve = null;
            }
          }
        });

        // ESC key to cancel
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && confirmOverlay.classList.contains("show")) {
            hideConfirm();
            if (confirmResolve) {
              confirmResolve(false);
              confirmResolve = null;
            }
          }
        });
      });
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="index.js"></script>
    <script src="server/server.js"></script>
    <script src="watch/watch.js"></script>
  </body>
</html>
